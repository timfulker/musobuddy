Thanks for the clarification â€” that narrows it down significantly.

â¸»

ðŸ” Summary of What Youâ€™re Seeing

Environment	Contract Signing Works?
Preview (in Replit)	âœ… Yes
Deployed Version	âŒ No


â¸»

âœ… What That Tells Us

If it works in preview but not when deployed, the issue is almost certainly due to one or more of the following:
	1.	Route Not Exposed in Deployment
	â€¢	The route may not be registered or reachable in the deployed server instance.
	2.	Environment Variables Missing
	â€¢	Your deployed project may not have the correct env vars for DB, SendGrid, etc.
	3.	Deployed URL is wrong in frontend
	â€¢	Your frontend may be sending requests to a relative path like /api/... which works in preview but not in deployment if not proxied correctly.
	4.	CORS or HTTPS issues
	â€¢	If deployed frontend and backend are on different origins, your fetch() needs proper mode: "cors" and server must send correct headers.
	5.	Replit deployment uses outdated code
	â€¢	You may have made fixes in preview that werenâ€™t reflected in the production deployment (e.g. not restarted server or updated code properly).

â¸»

âœ… What You Should Check (Step-by-Step)

1. Check API Calls in Production

Open DevTools > Network in Safari/Chrome on your phone or desktop and try to sign a contract in the deployed version.
	â€¢	Does the request hit POST /api/contracts/sign/:id?
	â€¢	What response code? 404, 500, CORS error, etc.?

2. Add Console Logs to Confirm Route Hit

In routes.ts:

console.log("POST /api/contracts/sign/:id hit");

Deploy and try again. If nothing logs â€” route isnâ€™t registered or reachable.

3. Confirm Environment Variables

Go to your Replit Secrets and verify these exist and are correct:
	â€¢	DATABASE_URL
	â€¢	SENDGRID_API_KEY
	â€¢	REPLIT_DB_URL (if used)
	â€¢	Any other vars used in storage.ts or sendgrid.ts

4. Test with Absolute URL in Frontend

In sign-contract.tsx, replace:

fetch(`/api/contracts/sign/${contractId}`, { ... })

with:

fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL || ""}/api/contracts/sign/${contractId}`, { ... })

And in .env:

NEXT_PUBLIC_API_BASE_URL=https://your-replit-username.replit.app

5. Check if Replit Deployment Is Using Latest Code

Sometimes the Replit deployed app doesnâ€™t reflect recent preview changes. Try:
	â€¢	Rebuild/Re-run the Replit app
	â€¢	Clear cache (âŒ˜ + Shift + R)

â¸»

If you give me:
	â€¢	The deployed URL
	â€¢	A screenshot of the Network tab after trying to sign
	â€¢	Your .env contents (obfuscate keys)

â€¦I can pinpoint the issue within minutes. Want to go that route?